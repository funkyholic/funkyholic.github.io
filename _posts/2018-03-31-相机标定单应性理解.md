---
layout: post
date:   2018-03-31 
categories: tech test
desc:
---



# 相机标定单应性理解

平面单应变换（Planar Homography）定义了从一个平面到一个平面的对应关系，即单应变换矩阵H。
比如我们用相机拍摄一个平面物体（比如chessboard），那么从chessboard平面（世界坐标系）到成像平面（图像像素坐标系）就是一种单应变换，可通过单应矩阵H实现快速变换。如果同一个相机从不同角度拍摄同一个平面，那么所得到的两个成像平面之间也是单应变换。

如果世界坐标系上的点P(X,Y,Z,1)在单应变换下和图像坐标系上的点p(u,v,1)对应，那么可以:
p = HP

$$\begin{bmatrix}
	u  \\
	v \\
	1 
\end{bmatrix} = M
\begin{bmatrix}
	r1 & r2 & r3 & T
\end{bmatrix}
\begin{bmatrix}
	X  \\
	Y \\
	Z \\
	1
\end{bmatrix}$$



其中H是3 x 4单应矩阵。但是由于P点是在一个平面上，因此我们设定Z=0。因此H可以简化成3 x 3矩阵。
不考虑图像扭曲，单应矩阵由两部分组成，H=MW，物理变换和投影变换。
物理变换实现了从世界坐标系到相机坐标系的变换。
W = [R T] 其中R是旋转矩阵，T是位移矩阵。
投影变换实现了从相机坐标系到图像坐标系的变换。
M 是相机内参矩阵。

$$
M =
\begin{bmatrix}
	fx & 0 & cx \\
	0 & fy & cy \\
	0 & 0 & 1
\end{bmatrix}
$$

我们设 H = MW 
p和P是我们已知的。在实际标定过程中，我们有一张标定图片，在上面寻找角点，这个就是图像物理坐标p。
而世界坐标P需要自己构建，比如对于chessboard，设该平面为Z=0，并且定义一个square边长n，那么角点坐标就能以(0,0) (n,0) (2n,0) ....表示了。
p = HP
$$
H =
\begin{bmatrix}
	h11 & h12 & h13 \\
	h21 & h22 & h23 \\
	h31 & h32 & h33
\end{bmatrix}
$$
由于我们用的齐次坐标，H乘以一个常数，并不影响p点所表示的笛卡尔坐标。
因此我们设h33=1，则H只有8个自由度，即我们需要求解8个未知变量。
对于一对匹配点（P，p）而言，能够给出2个方程，那么我们一共需要4对点，就能求得H的唯一解。
正因为4对点可以得到8个方程，以此来求出8个未知系数，唯一决定一个H。再多来一对点，只不过是冗余信息，因此4对点就够了（除非有噪声）。但是我们有4个内参系数fx,fx,cx,cy和6个外参R和T，那么最少也需要2副图片来确定这些参数。

简单的方法假设cx,cy为0，那么只需要1副图就可以了。

通过H我们可以进一步求得M和W。即内参与外参，这就是摄像机标定。

外参，即是摄像机与被拍摄物体的相对位置。



